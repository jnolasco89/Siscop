<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-lg-12">
                <div class="card">
                    <h1 style="margin-top:0">Mantenimiento de cuentas contables</h1>
                    <h:form id="formTabs">
                        <p:growl id="growl" 
                                 showDetail="true"
                                 for="msgGrowl"
                                 />
                        <p:tabView id="tabs" 
                                   activeIndex="#{cuentasControllerTree.tabActiva}" 
                                   >
                            <p:tab id="busqueda" title="BÃºsqueda">
                                <p:menubar>
                                    <p:menuitem 
                                        value="Buscar" 
                                        actionListener="#{mttoActividades.buscarActividad()}" 
                                        icon="ui-icon-search"
                                        update="tablaProyectos"
                                        process="@this datosBusquedaProyecto"
                                        />
                                    <p:menuitem 
                                        value="Limpiar" 
                                        action="#{mttoActividades.limpiarBusquedaActividad()}" 
                                        update=":formTabs:tabs"
                                        icon="fa fa-eraser" 
                                        process="@this"
                                        />
                                </p:menubar>
                                <p:panelGrid id="datosBusquedaProyecto" columns="4" layout="grid" style="border:0px !important; background:none;"
                                             styleClass="ui-panelgrid-blank">
                                    <p:outputLabel for="txtNombreB" value="Nombre:" />
                                    <p:inputText id="txtNombreB" value="#{mttoProyecto.nombreB}"                                                     
                                                 onkeyup="this.value = this.value.toUpperCase();"/>
                                    <p:outputLabel for="txtNombreCortoB" value="Nombre Corto:" />
                                    <p:inputText id="txtNombreCortoB" value="#{mttoProyecto.nombreCortoB}"
                                                 onkeyup="this.value = this.value.toUpperCase();"/>
                                    <p:outputLabel for="txtCodigo" value="CÃ³digo:" />
                                    <p:inputText id="txtCodigo" value="#{mttoProyecto.codigoB}"/>

                                </p:panelGrid>
                                <div class="card">
                                    <p:dataTable id="tablaProyectos" var = "proy" value="#{mttoProyecto.proyectosList}"
                                                 selectionMode="single"
                                                 selection="#{mttoProyecto.proyectoB}"
                                                 rowKey="#{proy.id}"
                                                 paginator="true"
                                                 rows ="10"
                                                 paginatorPosition="bottom"
                                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 rowsPerPageTemplate="10,20,50">
                                        <p:ajax event="rowSelect" listener="#{mttoProyecto.onRowSelect(event)}"
                                                update="formTabs" />
                                        <p:column headerText="Id" width="10%">
                                            <h:outputText value="#{proy.id}" />
                                        </p:column>
                                        <p:column headerText="Proyecto">
                                            <h:outputText value="#{proy.nombreCorto}" />
                                        </p:column>
                                    </p:dataTable>
                                </div>
                                
                            </p:tab>
                            <p:tab id="catalogo" title="Catalogo">
                                <p:tree
                                    id="tree-catalogo-cuentas" 
                                    value="#{cuentasControllerTree.arbolCuentas}" 
                                    var="nodo" 
                                    selectionMode="single"
                                    selection="#{cuentasControllerTree.nodoActual}"
                                    filterBy="#{nodo}"
                                    animate="true"
                                    styleClass="tree-cuentas"
                                    >
                                    <p:ajax event="select" 
                                            update=":formTabs" 
                                            listener="#{cuentasControllerTree.cargarCuentaSeleccionada()}"/>
                                    <p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{nodo}" />
                                    </p:treeNode>
                                </p:tree>
                            </p:tab>
                            <p:tab id="detalle" title="Detalle">
                                <p:panelGrid>

                                    <p:menubar>
                                        <p:menuitem
                                            value="Guardar"
                                            icon="ui-icon-disk"
                                            actionListener="#{cuentasControllerTree.accionBtnGuardar()}"
                                            update=":formTabs:growl 
                                            :formTabs:tabs:panel-cuenta 
                                            :formTabs:tabs:tree-catalogo-cuentas 
                                            :formDialogCuentas:contenedor-tree-dialog"
                                            />
                                        <p:menuitem
                                            value="Limpiar"
                                            icon="fa fa-eraser"
                                            update=":formTabs"
                                            />
                                    </p:menubar>
                                </p:panelGrid>
                                <p:panel
                                    id="panel-cuenta"
                                    style="margin-top: 5px;" 
                                    header="Cuenta">

                                    <div class="ui-g" style="width: 700px;">
                                        <div class="ui-md-6">
                                            <p:outputLabel for="txtSubcuentaDe"
                                                           value="Subcuenta de:"
                                                           />
                                        </div>
                                        <div class="ui-md-6">
                                            <div class="ui-inputgroup input-cta-padre">
                                                <p:inputText id="txtSubcuentaDe"
                                                             value="#{cuentasControllerTree.cuentaPadreActual}"
                                                             disabled="true"
                                                             >
                                                </p:inputText>
                                                <p:commandButton icon="ui-icon-search"  
                                                                 styleClass="white-button"
                                                                 type="button"
                                                                 onclick="PF('dialogCuentas').show()"/>  
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ui-g" style="width: 700px;">
                                        <div class="ui-md-6">
                                            <p:outputLabel for="txtCodigoCuenta" 
                                                           value="Codigo: "
                                                           />
                                        </div>
                                        <div class="ui-md-6">
                                            <p:inputText id="txtCodigoCuenta" 
                                                         value="#{cuentasControllerTree.cuentaActual.codigo}"
                                                         validator="#{cuentasControllerTree.validaciones.validarCodigoCuenta}"
                                                         >
                                                <p:message for="txtCodigoCuenta"/>
                                            </p:inputText>
                                        </div>
                                    </div>
                                    <div class="ui-g" style="width: 700px;">
                                        <div class="ui-md-6">
                                            <p:outputLabel for="txtNombreCuenta"
                                                           value="Nombre: "
                                                           />
                                        </div>
                                        <div class="ui-md-6">
                                            <p:inputText id="txtNombreCuenta"
                                                         value="#{cuentasControllerTree.cuentaActual.nombre}"
                                                         validator="#{cuentasControllerTree.validaciones.validarNombreCuenta}"
                                                         >
                                                <p:message for="txtNombreCuenta"/>
                                            </p:inputText>
                                        </div>
                                    </div>
                                    <div class="ui-g" style="width: 700px;">
                                        <div class="ui-md-6">
                                            <p:outputLabel for="txtDescripcionCuenta"
                                                           value="Descripcion: "
                                                           />
                                        </div>
                                        <div class="ui-md-6">
                                            <p:inputTextarea id="txtDescripcionCuenta"
                                                             rows="5" 
                                                             cols="30"
                                                             value="#{cuentasControllerTree.cuentaActual.descripcion}"
                                                             />
                                        </div>
                                    </div>
                                </p:panel>
                                <p:fileUpload fileUploadListener="#{cuentasControllerTree.subirYprocesarArchivo}" 
                                              mode="advanced" 
                                              dragDropSupport="false"
                                              sizeLimit="10000000" 
                                              fileLimit="1" 
                                              allowTypes="/(\.|\/)(xlsx|xls)$/" 
                                              label="Buscar"
                                              uploadLabel="Subir"
                                              cancelLabel="Cancelar"/>
                            </p:tab>
                        </p:tabView>
                    </h:form>

                    <h:form id="formDialogCuentas">
                        <p:dialog id="dialogCuentas" 
                                  widgetVar="dialogCuentas" 
                                  modal="true" 
                                  header="Cuentas" 
                                  width="500" 
                                  height="300"
                                  resizable="false"

                                  >
                            <p:scrollPanel id="contenedor-tree-dialog" style="width: 450px;height: 250px;">
                                <p:tree value="#{cuentasControllerTree.arbolCuentas}" 
                                        var="nodo" 
                                        selectionMode="single"
                                        selection="#{cuentasControllerTree.nodoActual}"
                                        filterBy="#{nodo}"
                                        animate="true"
                                        >
                                    <p:ajax event="select" 
                                            listener="#{cuentasControllerTree.actualizarCuentaPadre()}"
                                            oncomplete="PF('dialogCuentas').hide()"
                                            update="formTabs:tabs:txtSubcuentaDe"
                                            />
                                    <p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{nodo}" />
                                    </p:treeNode>
                                </p:tree>
                            </p:scrollPanel>
                            <h:panelGrid columns="3">
                                <p:commandButton 
                                    value="Cancelar" 
                                    type="button"
                                    onclick="PF('dialogCuentas').hide()"

                                    />
                            </h:panelGrid>
                        </p:dialog>
                    </h:form>
                </div>
            </div>
        </div>
    </ui:define>
</ui:composition>