<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-lg-12">
                <p:layoutUnit position="center">
                    <h3 style="margin-top:0">Mantenimiento de cuentas contables</h3>
                    <h:form id="formTabs">
                        <p:growl id="growl" 
                                 showDetail="true" 
                                 for="msgMttoCuentas"/>
                        <p:tabView id="tabs" 
                                   activeIndex="#{cuentasControllerTree.tabActivo}" 
                                   >
                            <p:tab id="busqueda" title="BÃºsqueda">
                                <h:panelGrid>
                                    <p:menubar>
                                        <p:menuitem>
                                            <p:inputText id="txtCampoBusqueda"/>
                                        </p:menuitem>
                                        <p:menuitem 
                                            value="Buscar" 
                                            icon="ui-icon-search"
                                            actionListener="#{cuentasControllerTree.buscarCuenta()}"
                                            />
                                        <p:menuitem 
                                            value="Limpiar" 
                                            icon="ui-icon-refresh" 
                                            actionListener="#{cuentasControllerTree.limpiar()}"
                                            update=":formTabs"
                                            />
                                    </p:menubar>
                                </h:panelGrid>
                                <p:tree value="#{cuentasControllerTree.raiz}" 
                                        var="nodo" 
                                        selectionMode="single"
                                        selection="#{cuentasControllerTree.nodoSeleccionado}"
                                        dynamic="true"
                                        >
                                    <p:ajax event="select" update=":formTabs" listener="#{cuentasControllerTree.actualizarCuentaSeleccionada()}"/>
                                    <p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{nodo}" />
                                    </p:treeNode>
                                </p:tree>
                            </p:tab>
                            <p:tab id="detalle" title="Detalle">
                                <p:panelGrid>
                                    <p:menubar>
                                        <p:menuitem
                                            value="Guardar"
                                            icon="ui-icon-disk"
                                            />
                                        <p:menuitem
                                            value="Limpiar"
                                            icon="ui-icon-refresh"
                                            action="#{cuentasControllerTree.limpiar()}"
                                            update=":formTabs"
                                            />

                                    </p:menubar>

                                </p:panelGrid>
                                <p:panel
                                    style="margin-top: 5px;" 
                                    header="Catalogo">
                                    <h:panelGrid columns="2" cellpadding="5">
                                        <p:outputLabel for="txtSubcuentaDe"
                                                       value="Subcuenta de:"
                                                       />
                                        <p:inputText id="txtSubcuentaDe"
                                                     value="#{cuentasControllerTree.codigoCuentaPadre}"
                                                     onclick="PF('dialogCuentas').show()"
                                                     />
                                        <p:outputLabel for="txtCodigoCuenta" 
                                                       value="Codigo: "
                                                       />
                                        <p:inputText id="txtCodigoCuenta" 
                                                     value="#{cuentasControllerTree.ctaSeleccionada.codigo}"
                                                     />
                                        <p:outputLabel for="txtNombreCuenta"
                                                       value="Nombre: "
                                                       />
                                        <p:inputText id="txtNombreCuenta"
                                                     value="#{cuentasControllerTree.ctaSeleccionada.nombre}"
                                                     />
                                        <p:outputLabel for="txtDescripcionCuenta"
                                                       value="Descripcion: "
                                                       />
                                        <p:inputTextarea id="txtDescripcionCuenta"
                                                         rows="5" 
                                                         cols="30"
                                                         value="#{cuentasControllerTree.ctaSeleccionada.descripcion}"
                                                         />
                                    </h:panelGrid>
                                </p:panel>
                            </p:tab>
                        </p:tabView>
                    </h:form>

                    <h:form id="formSubirArchivo" enctype="multipart/form-data">
                        <p:fileUpload fileUploadListener="#{cuentasControllerTree.handleFileUpload}" 
                                      mode="advanced" 
                                      dragDropSupport="false"
                                      sizeLimit="100000" 
                                      fileLimit="3" 
                                      allowTypes="/(\.|\/)(xlsx|xls)$/" 
                                      label="Buscar"
                                      uploadLabel="Subir"
                                      cancelLabel="Cancelar"/>
                    </h:form>

                    <h:form id="formDialogCuentas">
                        <p:dialog id="dialogCuentas" 
                                  widgetVar="dialogCuentas" 
                                  modal="true" 
                                  header="Cuentas" 
                                  width="500" 
                                  height="300"
                                  resizable="false"

                                  >
                            <p:scrollPanel style="width: 450px;height: 250px;">
                                <p:tree value="#{cuentasControllerTree.raiz}" 
                                        var="nodo" 
                                        selectionMode="single"
                                        selection="#{cuentasControllerTree.nodoSeleccionado}"
                                        dynamic="true"
                                        >
                                    <p:ajax event="select" 
                                            update=":formTabs:tabs:detalle" 
                                            listener="#{cuentasControllerTree.actualizarCuentaPadre()}"
                                            oncomplete="PF('dialogCuentas').hide()"
                                            />
                                    <p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{nodo}" />
                                    </p:treeNode>
                                </p:tree>
                            </p:scrollPanel>
                            <h:panelGrid columns="3">
                                <p:commandButton 
                                    value="Cancelar" 
                                    type="button"
                                    onclick="PF('dialogCuentas').hide()"

                                    />
                            </h:panelGrid>
                        </p:dialog>
                    </h:form>
                </p:layoutUnit>
            </div>
        </div>
    </ui:define>
</ui:composition>