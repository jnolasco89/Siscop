<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml"
                xmlns:jsf="http://xmlns.jcp.org/jsf">

    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-lg-12">
                <div class="card">
                    <h1 style="margin-top:0">Mantenimiento de cuentas contables</h1>
                    <h:form id="formTabs">
                        <p:growl id="growl" 
                                 showDetail="true"
                                 for="msgGrowl"
                                 />
                        <p:tabView id="tabs" 
                                   activeIndex="#{mttoCuentasContables.tabActivo}" 
                                   >
                            <div class="card">
                                <p:tab id="busqueda" title="Búsqueda">
                                    <p:menubar>
                                        <p:menuitem 
                                            value="Buscar" 
                                            actionListener="#{mttoCuentasContables.pBusquedaBuscarProyecto()}" 
                                            icon="ui-icon-search"
                                            update="formTabs:tabs:tablaProyectos"
                                            process="@this :formTabs:tabs:datosProyectoBuscado"
                                            />
                                        <p:menuitem 
                                            value="Limpiar" 
                                            action="#{mttoCuentasContables.pBusquedalimpiarBusqueda()}" 
                                            update=":formTabs:tabs"
                                            icon="fa fa-eraser" 
                                            process="@this"
                                            />
                                    </p:menubar>
                                    <div class="card">
                                        <p:panelGrid 
                                            id="datosProyectoBuscado"
                                            columns="4" 
                                            layout="grid" 
                                            style="border:0px !important; background:none;"
                                            styleClass="ui-panelgrid-blank">
                                            <p:outputLabel for="txtCodigoProyectoB" value="Codigo:" />
                                            <p:inputText id="txtCodigoProyectoB" value="#{mttoCuentasContables.pestaniaBusqueda.proyectoAbuscar.codigo}"                                                     
                                                         onkeyup="this.value = this.value.toUpperCase();"/>
                                            <p:outputLabel for="txtNombreProyectoB" value="Nombre:" />
                                            <p:inputText id="txtNombreProyectoB" value="#{mttoCuentasContables.pestaniaBusqueda.proyectoAbuscar.nombre}"                                                     
                                                         onkeyup="this.value = this.value.toUpperCase();"/>
                                            <p:outputLabel for="txtNombreCortoB" value="Nombre Corto:" />
                                            <p:inputText id="txtNombreCortoB" value="#{mttoCuentasContables.pestaniaBusqueda.proyectoAbuscar.nombreCorto}"
                                                         onkeyup="this.value = this.value.toUpperCase();"/>
                                            <p:outputLabel for="listEstado" value="Estado:" />
                                            <p:selectOneMenu id="listEstado" 
                                                             value="#{mttoCuentasContables.pestaniaBusqueda.proyectoAbuscar.estado.id}"
                                                             >
                                                <f:selectItem itemLabel="Todos" itemValue="0"/>
                                                <f:selectItems value="#{mttoCuentasContables.pestaniaBusqueda.estadosProyecto}" 
                                                               var="estado" 
                                                               itemLabel="#{estado.descripcion}"
                                                               itemValue="#{estado.id}"
                                                               />
                                            </p:selectOneMenu>
                                            <p:outputLabel for="fechaInicioB" value="Fecha inicio:" />
                                            <p:calendar id="fechaInicioB" 
                                                        value="#{mttoCuentasContables.pestaniaBusqueda.proyectoAbuscar.fechaini}"
                                                        pattern="dd-MM-yyyy" 
                                                        mask="true"
                                                        locale="es"
                                                        navigator="true"
                                                        >
                                            </p:calendar>    
                                            <p:outputLabel for="fechaFinB" value="Fecha finalizacion:" />
                                            <p:calendar id="fechaFinB" 
                                                        value="#{mttoCuentasContables.pestaniaBusqueda.proyectoAbuscar.fechafin}"
                                                        pattern="dd-MM-yyyy" 
                                                        mask="true"
                                                        locale="es"
                                                        navigator="true"
                                                        >
                                            </p:calendar>
                                        </p:panelGrid>
                                    </div>
                                    <div class="card">
                                        <p:dataTable id="tablaProyectos" var = "pro" 
                                                     widgetVar="tablaProyectos"
                                                     value="#{mttoCuentasContables.pestaniaBusqueda.proyectosRegistrados}"
                                                     selectionMode="single"
                                                     selection="#{mttoCuentasContables.pestaniaBusqueda.proyectoActual}"
                                                     rowKey="#{pro.id}"
                                                     emptyMessage="Sin registros">
                                            <p:ajax event="rowSelect"
                                                    listener="#{mttoCuentasContables.pBusquedaCargarCatalogoDeCuentas()}"
                                                    update=":formTabs"
                                                    />
                                            <p:column headerText="Codigo">
                                                <h:outputText value="#{pro.codigo}" />
                                            </p:column>
                                            <p:column headerText="Nombre">
                                                <h:outputText value="#{pro.nombre}" />
                                            </p:column>
                                            <p:column headerText="Nombre corto">
                                                <h:outputText value="#{pro.nombreCorto}" />
                                            </p:column>
                                            <p:column headerText="Fecha inicio">
                                                <h:outputText value="#{pro.fechaini}">
                                                    <f:convertDateTime pattern="dd-MM-yyyy"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Fecha finalizacion">
                                                <h:outputText value="#{pro.fechafin}" >
                                                    <f:convertDateTime pattern="dd-MM-yyyy"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Estado">
                                                <h:outputText value="#{pro.estado.descripcion}" />
                                            </p:column>
                                        </p:dataTable>
                                    </div>
                                </p:tab>
                            </div>
                            <div  class="card">
                                <p:tab id="catalogo" title="Catalogo">
                                    <p:menubar>
                                        <p:menuitem
                                            id="mnNuevoCatalogo"
                                            value="Nuevo"
                                            process="@this"
                                            action="#{mttoCuentasContables.pCatalogoLimpiarComponentes()}"
                                            icon="fa fa-user-plus"
                                            update=":formTabs:tabs:datosProyectoCatalogo :formTabs:tabs:contenedorArbolCuentas"
                                            />                                       
                                        <p:menuitem 
                                            id="mnGuardarCatalogo"
                                            value="Guardar" 
                                            action="#{mttoCuentasContables.pCatalogoGuardarCatalogo()}"
                                            icon="fa fa-save"
                                            process="@this txtProyecto"
                                            onclick="onComplete();"
                                            />
                                    </p:menubar>
                                    <div jsf:id="datosProyectoCatalogo" class="ui-g ui-panelgrid-blank">
                                        <div class="ui-g">
                                            <div class="ui-g-4">
                                                <p:outputLabel for="txtProyecto" value="Proyecto:" />
                                            </div>
                                            <div class="ui-g-8">
                                                <div class="ui-inputgroup">
                                                    <p:inputText id="txtProyecto"
                                                                 value="#{mttoCuentasContables.pestaniaCatalogo.proyectoActual.nombreCorto}"
                                                                 readonly="true"
                                                                 >
                                                    </p:inputText>
                                                    <p:commandButton icon="ui-icon-search"  
                                                                     styleClass="white-button"
                                                                     process="@this"
                                                                     actionListener="#{mttoCuentasContables.mBuscarProyectoAbrirModal()}"
                                                                     />  
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div jsf:id="contenedorArbolCuentas" class="ui-g ui-panelgrid-blank">
                                        <div class="ui-g" >
                                            <div class="ui-g-4" >
                                                <p:outputLabel value="Archivo:" for="fileLoader"/>
                                            </div>
                                            <div class="ui-g-12" >
                                                <p:fileUpload 
                                                    id="fileLoader"
                                                    fileUploadListener="#{mttoCuentasContables.pCtalogoSubirYprocesarArchivo}" 
                                                    mode="advanced" 
                                                    dragDropSupport="false"
                                                    sizeLimit="10000000" 
                                                    fileLimit="1" 
                                                    allowTypes="/(\.|\/)(xlsx|xls)$/" 
                                                    label="Buscar"
                                                    uploadLabel="Subir"
                                                    cancelLabel="Cancelar"
                                                    onstart="onStart();"
                                                    oncomplete="onComplete();"
                                                    />
                                            </div>
                                        </div>
                                        <div id="divBarraDeProgreso" class="ui-lg-12 ui-md-12 ui-sm-12" style="display: none;">
                                            <h3>Procesando archivo...</h3>
                                            <p:progressBar id="barraDeProgreso" style="height:6px;" mode="indeterminate" />
                                        </div>

                                        <div class="ui-lg-12 ui-md-12 ui-sm-12">
                                        </div>

                                        <div class="ui-lg-3">
                                            <p:commandButton
                                                icon="ui-icon-plus"
                                                value="Agregar cuenta principal"
                                                actionListener="#{mttoCuentasContables.mAgregarCuentasPrincipalesAbrir()}"

                                                process="@this"
                                                >
                                            </p:commandButton>
                                        </div>
                                        <p:tree
                                            id="tree-catalogo-cuentas" 
                                            value="#{mttoCuentasContables.pestaniaCatalogo.arbolCuentasTreeNode}" 
                                            var="nodo" 
                                            selectionMode="single"
                                            selection="#{mttoCuentasContables.pestaniaCatalogo.nodoActual}"
                                            filterBy="#{nodo}"
                                            animate="true"
                                            styleClass="tree-cuentas"

                                            >
                                            <p:ajax event="select" 
                                                    listener="#{mttoCuentasContables.pCatalogoCargarCuentaSeleccionada()}"
                                                    />
                                            <p:treeNode expandedIcon="ui-icon-folder-open" 
                                                        collapsedIcon="ui-icon-folder-collapsed"
                                                        styleClass="tree-cuentas"

                                                        >
                                                <p:commandButton
                                                    type="button"
                                                    styleClass="btn-tree-catalogo"
                                                    onclick="PF('overlayOpcionesCuenta').show('#{component.clientId}')" 
                                                    value="#{nodo}"
                                                    >

                                                </p:commandButton>
                                                <!--<h:outputText value="#{nodo}" />-->
                                            </p:treeNode>
                                        </p:tree>
                                    </div>
                                </p:tab>
                            </div>
                        </p:tabView>
                    </h:form>

                    <h:form id="formDialogProyectos">
                        <p:dialog id="dialogProyectos" 
                                  widgetVar="dialogProyectos" 
                                  modal="true" 
                                  header="Proyectos" 
                                  width="800" 
                                  height="480"
                                  resizable="false"
                                  >
                            <p:menubar>
                                <p:menuitem 
                                    value="Buscar" 
                                    actionListener="#{mttoCuentasContables.mBuscarProyectoBuscar()}" 
                                    icon="ui-icon-search"
                                    update=":formDialogProyectos:tablaProyectosModal"
                                    process="@this datosProyectoBuscadoModal"
                                    />
                                <p:menuitem 
                                    value="Limpiar" 
                                    action="#{mttoCuentasContables.mBuscarProyectoLimpiar()}" 
                                    update=":formDialogProyectos:datosProyectoBuscadoModal :formDialogProyectos:tablaProyectosModal"
                                    icon="fa fa-eraser" 
                                    process="@this"
                                    />
                            </p:menubar>
                            <div class="card">
                                <p:panelGrid 
                                    id="datosProyectoBuscadoModal"
                                    columns="4" 
                                    layout="grid" 
                                    style="border:0px !important; background:none;"
                                    styleClass="ui-panelgrid-blank">
                                    <p:outputLabel for="txtCodigoProyectoBM" value="Codigo:" />
                                    <p:inputText id="txtCodigoProyectoBM" value="#{mttoCuentasContables.modalBusquedaProyecto.proyectoAbuscar.codigo}"                                                     
                                                 onkeyup="this.value = this.value.toUpperCase();"/>
                                    <p:outputLabel for="txtNombreProyectoBM" value="Nombre:" />
                                    <p:inputText id="txtNombreProyectoBM" value="#{mttoCuentasContables.modalBusquedaProyecto.proyectoAbuscar.nombre}"                                                     
                                                 onkeyup="this.value = this.value.toUpperCase();"/>
                                    <p:outputLabel for="txtNombreCortoBM" value="Nombre Corto:" />
                                    <p:inputText id="txtNombreCortoBM" value="#{mttoCuentasContables.modalBusquedaProyecto.proyectoAbuscar.nombreCorto}"
                                                 onkeyup="this.value = this.value.toUpperCase();"/>
                                    <p:outputLabel for="listEstadoM" value="Estado:" />
                                    <p:selectOneMenu id="listEstadoM" 
                                                     value="#{mttoCuentasContables.modalBusquedaProyecto.proyectoAbuscar.estado.id}"
                                                     >
                                        <f:selectItem itemLabel="Todos" itemValue="0"/>
                                        <f:selectItems value="#{mttoCuentasContables.modalBusquedaProyecto.estadosProyecto}" 
                                                       var="estado" 
                                                       itemLabel="#{estado.descripcion}"
                                                       itemValue="#{estado.id}"
                                                       />
                                    </p:selectOneMenu>
                                    <p:outputLabel for="fechaInicioBM" value="Fecha inicio:" />
                                    <p:calendar id="fechaInicioBM" 
                                                value="#{mttoCuentasContables.modalBusquedaProyecto.proyectoAbuscar.fechaini}"
                                                pattern="dd-MM-yyyy" 
                                                mask="true"
                                                locale="es"
                                                navigator="true"
                                                >
                                    </p:calendar>    
                                    <p:outputLabel for="fechaFinBM" value="Fecha finalizacion:" />
                                    <p:calendar id="fechaFinBM" 
                                                value="#{mttoCuentasContables.modalBusquedaProyecto.proyectoAbuscar.fechafin}"
                                                pattern="dd-MM-yyyy" 
                                                mask="true"
                                                locale="es"
                                                navigator="true"
                                                >
                                    </p:calendar>
                                </p:panelGrid>
                            </div>
                            <p:scrollPanel id="contenedor-proyectos" style="width: 770px;height: 250px;">
                                <p:dataTable id="tablaProyectosModal" var = "pro" 
                                             widgetVar="tablaProyectosModal"
                                             value="#{mttoCuentasContables.modalBusquedaProyecto.proyectosRegistrados}"
                                             selectionMode="single"
                                             selection="#{mttoCuentasContables.modalBusquedaProyecto.proyectoActual}"
                                             rowKey="#{pro.id}"
                                             emptyMessage="Sin registros">
                                    <p:ajax event="rowSelect"
                                            listener="#{mttoCuentasContables.mBuscarProyectoCargarProyecto()}"
                                            />
                                    <p:column headerText="Código">
                                        <h:outputText value="#{pro.codigo}" />
                                    </p:column>
                                    <p:column headerText="Nombre">
                                        <h:outputText value="#{pro.nombre}" />
                                    </p:column>
                                    <p:column headerText="Nombre Corto">
                                        <h:outputText value="#{pro.nombreCorto}" />
                                    </p:column>
                                    <p:column headerText="Fecha inicio">
                                        <h:outputText value="#{pro.fechaini}">
                                            <f:convertDateTime pattern="dd-MM-yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Fecha finalizacion">
                                        <h:outputText value="#{pro.fechafin}" >
                                            <f:convertDateTime pattern="dd-MM-yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Estado">
                                        <h:outputText value="#{pro.estado.descripcion}" />
                                    </p:column>
                                </p:dataTable>
                            </p:scrollPanel>
                            <h:panelGrid columns="3">
                                <p:commandButton 
                                    value="Cancelar" 
                                    process="@this"
                                    actionListener="#{mttoCuentasContables.mBuscarProyectoCerrarModal()}"
                                    />
                            </h:panelGrid>
                        </p:dialog>
                    </h:form>

                    <h:form id="formOverlay">
                        <p:overlayPanel widgetVar="overlayOpcionesCuenta" showEffect="fade" hideEffect="fade" dismissable="false" showCloseIcon="true">
                            <p:outputPanel style="text-align:center;">
                                <p:panelGrid  columns="1" styleClass="ui-panelgrid-blank">
                                    <p:commandButton icon="ui-icon-plus"  
                                                     styleClass="white-button"
                                                     value="Agregar subcuenta(s)"
                                                     actionListener="#{mttoCuentasContables.mAgregarSubcuentasAbrir()}"
                                                     />  
                                    <p:commandButton icon="ui-icon-pencil"  
                                                     styleClass="white-button"
                                                     value="Editar"
                                                     actionListener="#{mttoCuentasContables.mEditarCuentaAbrir()}"
                                                     />
                                    <p:commandButton icon="ui-icon-trash"  
                                                     styleClass="white-button"
                                                     value="Eliminar"
                                                     actionListener="#{mttoCuentasContables.eliminarCuentaDeArbol()}"/>  
                                </p:panelGrid>
                            </p:outputPanel>
                        </p:overlayPanel>
                    </h:form>

                    <h:form id="formModalAgregarSubcuentas">
                        <p:dialog id="dialogAgregarSubcuentas" 
                                  widgetVar="dialogAgregarSubcuentas" 
                                  modal="true" 
                                  header="#{mttoCuentasContables.modalAgregarCuentas.tituloModal}" 
                                  width="570" 
                                  height="345"
                                  resizable="false"
                                  >
                            <div jsf:id="panel-modal-subcuenta" class="ui-g ui-panelgrid-blank">
                                <div class="ui-g-6" >
                                    <div class="ui-g-12" >
                                        <p:outputLabel for="txtCuentaPadreSub" 
                                                       value="Cuenta padre:"
                                                       rendered="#{mttoCuentasContables.modalAgregarCuentas.verCuentaPadre}"
                                                       />
                                        <div class="ui-inputgroup input-cta-padre">
                                            <p:inputText id="txtCuentaPadreSub"
                                                         value="#{mttoCuentasContables.modalAgregarCuentas.cuentaPadre.cuentaPK.codigo}  #{mttoCuentasContables.modalAgregarCuentas.cuentaPadre.nombre}"
                                                         disabled="true"
                                                         rendered="#{mttoCuentasContables.modalAgregarCuentas.verCuentaPadre}"
                                                         >
                                            </p:inputText>
                                        </div>
                                    </div>
                                    <div class="ui-g-12" >
                                        <p:outputLabel for="txtCodigoCuentaSub" value="Codigo: "/>

                                        <p:inputText id="txtCodigoCuentaSub" 
                                                     value="#{mttoCuentasContables.modalAgregarCuentas.cuentaActual.cuentaPK.codigo}"
                                                     >
                                            <p:message for="txtCodigoCuentaSub"/>
                                        </p:inputText>
                                    </div>
                                    <div class="ui-g-12" >
                                        <p:outputLabel for="txtNombreCuentaSub" value="Nombre: "/>
                                        <p:inputText id="txtNombreCuentaSub"
                                                     value="#{mttoCuentasContables.modalAgregarCuentas.cuentaActual.nombre}"
                                                     >
                                            <p:message for="txtNombreCuentaSub"/>
                                        </p:inputText>
                                    </div>
                                    <div class="ui-g-12" >
                                        <p:outputLabel for="txtDescripcionCuentaSub" value="Descripcion: "/>
                                        <p:inputTextarea id="txtDescripcionCuentaSub"
                                                         rows="5" 
                                                         cols="30"
                                                         value="#{mttoCuentasContables.modalAgregarCuentas.cuentaActual.descripcion}"
                                                         />
                                    </div>
                                    <div class="ui-g-6">
                                        <p:commandButton
                                            icon="ui-icon-plus"
                                            actionListener="#{mttoCuentasContables.mAgregarCuentaAgregar()}"
                                            update=":formModalAgregarSubcuentas:panel-modal-subcuenta"
                                            process="@this txtCuentaPadreSub txtCodigoCuentaSub txtNombreCuentaSub txtDescripcionCuentaSub"
                                            value="Agregar" 
                                            />    
                                    </div>
                                    <div class="ui-g-6">
                                        <p:commandButton
                                            icon="ui-icon-check"
                                            value="Aceptar" 
                                            process="@this"
                                            actionListener="#{mttoCuentasContables.mAgregarCuentaGuardar()}"
                                            />    
                                    </div>
                                </div>
                                <div class="ui-g-6">
                                    <p:dataTable id="tablaCuentasAagregar" 
                                                 var = "cta" 
                                                 widgetVar="tablaCuentasAagregar"
                                                 value="#{mttoCuentasContables.modalAgregarCuentas.cuentas}"
                                                 selection="#{mttoCuentasContables.modalAgregarCuentas.cuentaActual}"
                                                 emptyMessage="Sin registros"
                                                 rowIndexVar="index"
                                                 >
                                        <p:column headerText="Codigo">
                                            <h:outputText value="#{cta.cuentaPK.codigo}" />
                                        </p:column>
                                        <p:column headerText="Nombre">
                                            <h:outputText value="#{cta.nombre}" />
                                        </p:column>
                                        <p:column headerText="Opciones">
                                            <p:commandButton 
                                                icon="ui-icon-pencil" 
                                                style="width: 30px;margin: 0px 10px 0px 10px;"
                                                action="#{mttoCuentasContables.mAgregarCuentaCargarCuenta(index,cta)}" 
                                                update=":formModalAgregarSubcuentas:panel-modal-subcuenta"
                                                process="@this"
                                                />
                                            <p:commandButton 
                                                icon="ui-icon-trash" 
                                                style="width: 30px;margin: 0px 10px 0px 10px;"
                                                action="#{mttoCuentasContables.mAgregarCuentaElmiminarCuenta(index)}" 
                                                update=":formModalAgregarSubcuentas:panel-modal-subcuenta"
                                                process="@this"
                                                />
                                        </p:column>

                                    </p:dataTable>
                                </div>
                            </div>
                        </p:dialog>
                    </h:form>


                    <h:form id="formModalCuenta">
                        <p:dialog id="dialogCuenta" 
                                  widgetVar="dialogCuenta" 
                                  modal="true" 
                                  header="Editar cuenta" 
                                  width="350" 
                                  height="335"
                                  resizable="false"
                                  >
                            <div jsf:id="panel-modal-datos-cuenta" class="ui-g ui-panelgrid-blank">
                                <div class="ui-g-12" >
                                    <div class="ui-g-12" >
                                        <p:outputLabel for="txtCodigoCuenta" value="Codigo: "/>

                                        <p:inputText id="txtCodigoCuenta" 
                                                     value="#{mttoCuentasContables.modalEditarCuenta.cuentaActual.cuentaPK.codigo}"
                                                     >
                                            <p:message for="txtCodigoCuenta"/>
                                        </p:inputText>
                                    </div>
                                    <div class="ui-g-12" >
                                        <p:outputLabel for="txtNombreCuenta" value="Nombre: "/>
                                        <p:inputText id="txtNombreCuenta"
                                                     value="#{mttoCuentasContables.modalEditarCuenta.cuentaActual.nombre}"
                                                     >
                                            <p:message for="txtNombreCuenta"/>
                                        </p:inputText>
                                    </div>
                                    <div class="ui-g-12" >
                                        <p:outputLabel for="txtDescripcionCuenta" value="Descripcion: "/>
                                        <p:inputTextarea id="txtDescripcionCuenta"
                                                         rows="5" 
                                                         cols="30"
                                                         value="#{mttoCuentasContables.modalEditarCuenta.cuentaActual.descripcion}"
                                                         />
                                    </div>
                                    <div class="ui-g-4">
                                        <p:commandButton 
                                            value="Aceptar"
                                            actionListener="#{mttoCuentasContables.mEditarCuentaEditar()}"
                                            process="@this txtCodigoCuenta txtNombreCuenta txtDescripcionCuenta"
                                            />    
                                    </div>
                                </div>
                            </div>
                        </p:dialog>
                    </h:form>

                    <script type="text/javascript">
                        window.addEventListener("load", function () {
                            onComplete();
                        });

                        function onStart() {
                            document.getElementById("divBarraDeProgreso").style.display = "block";
                        }

                        function onComplete() {
                            document.getElementById("divBarraDeProgreso").style.display = "none";
                        }
                    </script>

                </div>
            </div>
        </div>
    </ui:define>
</ui:composition>